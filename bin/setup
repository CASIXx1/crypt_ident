#!/usr/bin/env bash
# set -euo pipefail
# IFS=$'\n\t'
# set -vx

# This works for MRI; it may or may not work for other Rubies.
RUBY_VERSION=`ruby --version | cut -d ' ' -f 2 | sed 's/p.*//'`

##
## Initialise Gemset and setup if `rbenv` is available
##

rm -f Gemfile.lock .rbenv-gemsets

if [[ `rbenv --version 2>/dev/null` ]]; then
  rbenv local $RUBY_VERSION
  rbenv gemset delete $RUBY_VERSION ./tmp/gemset 2>/dev/null || true
  find ./tmp/gemset -delete 2>/dev/null || true
  rbenv rehash
  rbenv gemset create $RUBY_VERSION ./tmp/gemset
  echo ./tmp/gemset > .rbenv-gemsets
  rbenv rehash
fi

##
## Install Gems
##

# gem install yard:0.9.16
# yard config --gem-install-yri
# Build Gem list by running `scripts/build-gem-list.rb`
gem install --ignore-dependencies ansi:1.5.0 bcrypt:3.1.12 builder:3.2.3 byebug:10.0.2 thread_safe:0.3.6 ice_nine:0.11.2 descendants_tracker:0.0.4 axiom-types:0.1.1 coercible:1.0.0 equalizer:0.0.11 virtus:1.0.5 codeclimate-engine-rb:0.4.1 concurrent-ruby:1.1.3 docile:1.3.1 inflecto:0.0.2 dry-equalizer:0.2.1 dry-configurable:0.7.0 dry-container:0.6.0 dry-core:0.4.7 dry-logic:0.4.2 dry-types:0.11.1 erubis:2.7.0 path_expander:1.0.3 sexp_processor:4.11.0 ruby_parser:3.11.0 flay:2.12.0 flog:4.6.2 github-markup:3.0.1 transproc:1.0.2 hanami-utils:1.3.0 rack:2.0.6 hanami-controller:1.3.0 dry-struct:0.3.1 rom-mapper:0.5.1 dry-initializer:1.4.1 rom:3.3.3 rom-repository:1.4.0 sequel:4.49.0 rom-sql:1.3.5 hanami-model:1.3.0 yard:0.9.16 tins:1.20.2 term-ansicolor:1.7.0 sparkr:0.4.1 method_source:0.9.2 coderay:1.1.2 pry:0.12.2 inch:0.8.0 jaro_winkler:1.5.1 json:2.1.0 kwalify:0.7.2 minitest:5.11.3 minitest-hooks:1.5.0 minitest-matchers:1.4.1 ruby-progressbar:1.10.0 minitest-reporters:1.3.5 minitest-tagz:1.6.0 parallel:1.12.1 ast:2.4.0 parser:2.5.3.0 powerpack:0.1.2 pry-byebug:3.6.0 pry-doc:0.13.5 rainbow:3.0.0 rake:12.3.1 redcarpet:3.4.0 reek:5.2.0 unicode-display_width:1.4.0 rubocop:0.60.0 simplecov-html:0.10.2 simplecov:0.16.1 yard-classmethods:1.0.0

# ############################################################################ #

bundle install --binstubs --local
