#!/usr/bin/env bash
# set -euo pipefail
# IFS=$'\n\t'
# set -vx

# This works for MRI; it may or may not work for other Rubies.
RUBY_VERSION=`ruby --version | cut -d ' ' -f 2 | sed 's/p.*//'`

##
## Initialise Gemset and setup if `rbenv` is available
##

rm -f Gemfile.lock .rbenv-gemsets

if [[ `rbenv --version 2>/dev/null` ]]; then
  rbenv local $RUBY_VERSION
  rbenv gemset delete $RUBY_VERSION ./tmp/gemset 2>/dev/null || true
  find ./tmp/gemset -delete 2>/dev/null || true
  rbenv rehash
  rbenv gemset create $RUBY_VERSION ./tmp/gemset
  echo ./tmp/gemset > .rbenv-gemsets
  rbenv rehash
fi

##
## Install Gems
##

gem install yard:0.9.16
yard config --gem-install-yri

gem install --ignore-dependencies \
    bcrypt:3.1.12 \
    ansi:1.5.0 \
    ast:2.4.0 \
    thread_safe:0.3.6 \
    descendants_tracker:0.0.4 \
    ice_nine:0.11.2 \
    axiom-types:0.1.1 \
    builder:3.2.3 \
    byebug:10.0.2 \
    coercible:1.0.0 \
    equalizer:0.0.11 \
    virtus:1.0.5 \
    codeclimate-engine-rb:0.4.1 \
    coderay:1.1.2 \
    concurrent-ruby:1.0.5 \
    dry-configurable:0.7.0 \
    dry-container:0.6.0 \
    dry-core:0.4.7 \
    dry-equalizer:0.2.1 \
    dry-logic:0.4.2 \
    inflecto:0.0.2 \
    dry-types:0.11.1 \
    transproc:1.0.2 \
    hanami-utils:1.2.0 \
    rack:2.0.5 \
    hanami-controller:1.2.0 \
    dry-initializer:1.4.1 \
    rom-mapper:0.5.1 \
    rom:3.3.3 \
    dry-struct:0.3.1 \
    rom-repository:1.4.0 \
    sequel:4.49.0 \
    rom-sql:1.3.5 \
    hanami-model:1.2.0 \
    docile:1.3.1 \
    erubis:2.7.0 \
    path_expander:1.0.3 \
    sexp_processor:4.11.0 \
    ruby_parser:3.11.0 \
    flay:2.12.0 \
    flog:4.6.2 \
    method_source:0.9.0 \
    pry:0.11.3 \
    sparkr:0.4.1 \
    tins:1.17.0 \
    term-ansicolor:1.6.0 \
    inch:0.8.0 \
    jaro_winkler:1.5.1 \
    kwalify:0.7.2 \
    minitest-hooks:1.5.0 \
    minitest-matchers:1.4.1 \
    ruby-progressbar:1.10.0 \
    minitest-reporters:1.3.5 \
    minitest-tagz:1.6.0 \
    parallel:1.12.1 \
    parser:2.5.1.2 \
    powerpack:0.1.2 \
    pry-byebug:3.6.0 \
    pry-doc:0.13.4 \
    rainbow:3.0.0 \
    reek:5.2.0 \
    unicode-display_width:1.4.0 \
    rubocop:0.60.0 \
    simplecov-html:0.10.2 \
    simplecov:0.16.1 \
    yard-classmethods:1.0.0 \
    i18n:1.1.1 \
    ruby-enum:0.7.2 \
    github-markup:3.0.1 \
    redcarpet:3.4.0

# ############################################################################ #

bundle install --binstubs --local
