<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: CryptIdent
  
    &mdash; crypt_ident Module Documentation
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "CryptIdent";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (C)</a> &raquo;
    
    
    <span class="title">CryptIdent</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: CryptIdent
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>Hanami::Utils::ClassAttribute</dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/crypt_ident.rb<span class="defines">,<br />
  lib/crypt_ident/config.rb,<br /> lib/crypt_ident/sign_in.rb,<br /> lib/crypt_ident/sign_up.rb,<br /> lib/crypt_ident/version.rb,<br /> lib/crypt_ident/change_password.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Authenticated-User Password-change logic for CryptIdent</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Author:</p>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Jeff Dickey</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Version:</p>
<ul class="version">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="CryptIdent/Config.html" title="CryptIdent::Config (class)">Config</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="VERSION-constant" class="">VERSION =
          <div class="docstring">
  <div class="discussion">
    <p>Version number for Gem. Uses Semantic Versioning.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0.1.0</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#configure_crypt_ident-class_method" title="configure_crypt_ident (class method)">.<strong>configure_crypt_ident</strong> {|config| ... } &#x21d2; CryptIdent::Config </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Set configuration information at the class (actually, module) level.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_crypt_ident_config-class_method" title="reset_crypt_ident_config (class method)">.<strong>reset_crypt_ident_config</strong>  &#x21d2; CryptIdent::Config </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Reset configuration information to default values.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#change_password-instance_method" title="#change_password (instance method)">#<strong>change_password</strong>(user, current_password, new_password, repo: nil)  &#x21d2; User, Symbol </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Change an Authenticated User&#39;s password.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_reset_token-instance_method" title="#generate_reset_token (instance method)">#<strong>generate_reset_token</strong>(user_name)  &#x21d2; Symbol, true </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Request a Password Reset Token.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_password-instance_method" title="#reset_password (instance method)">#<strong>reset_password</strong>(token, new_password, confirmation)  &#x21d2; Symbol, true </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Reset the password for the User associated with a Password Reset Token.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#restart_session_counter-instance_method" title="#restart_session_counter (instance method)">#<strong>restart_session_counter</strong>  </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Restart the Session Expiration timestamp mechanism, to avoid prematurely signing out a User.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_expired%3F-instance_method" title="#session_expired? (instance method)">#<strong>session_expired?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Determine whether the Session has Expired due to User inactivity.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sign_in-instance_method" title="#sign_in (instance method)">#<strong>sign_in</strong>(user, password, current_user: nil)  &#x21d2; User<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Attempt to Authenticate a User, passing in an Entity for that User (which <strong>must</strong> contain a <code>password_hash</code> attribute), and a Clear-Text Password.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sign_out-instance_method" title="#sign_out (instance method)">#<strong>sign_out</strong>(&amp;_block) {|config| ... } </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Sign out a previously Authenticated User.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sign_up-instance_method" title="#sign_up (instance method)">#<strong>sign_up</strong>(attribs, current_user:, repo: nil, on_error: nil, &amp;_on_success)  &#x21d2; User, Symbol </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Persist a new User to a Repository based on passed-in attributes, with a <code>:password_hash</code> attribute containing the encrypted value of the Clear-Text Password passed in as the <code>password</code> attribute.</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="configure_crypt_ident-class_method">
  
    .<strong>configure_crypt_ident</strong> {|config| ... } &#x21d2; <tt><span class='object_link'><a href="CryptIdent/Config.html" title="CryptIdent::Config (class)">CryptIdent::Config</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Set configuration information at the class (actually, module) level.</p>

<p><strong>IMPORTANT:</strong> Even though we follow time-honoured convention
here and call the variable yielded by the <code>CryptIdent.configure_crypt_ident</code>
block <code>config</code>, settings <em>are not</em> being stored in an <em>instance variable</em>
called <code>@config</code>. That is <em>too likely</em> to conflict with something Important;
remember, we&#39;re a module, not a class, and good table manners are <em>also</em>
Important.</p>

<p>This is normally run from the <code>controller.prepare</code> block inside your app&#39;s
<code>apps/&lt;app name&gt;/application.rb</code> file, where the default for <code>app_name</code> in a
Hanami app is <code>web</code>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="CryptIdent (module)">CryptIdent</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure_crypt_ident'>configure_crypt_ident</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span> <span class='comment'># show defaults
</span>  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_error_key'>error_key</span> <span class='op'>=</span> <span class='symbol'>:error</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_guest_user'>guest_user</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_hashing_cost'>hashing_cost</span> <span class='op'>=</span> <span class='int'>8</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_repository'>repository</span> <span class='op'>=</span> <span class='const'>UserRepository</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_guest_user'>guest_user</span> <span class='op'>=</span> <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_repository'>repository</span><span class='period'>.</span><span class='id identifier rubyid_guest_user'>guest_user</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_reset_expiry'>reset_expiry</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>24</span> <span class='op'>*</span> <span class='int'>60</span> <span class='op'>*</span> <span class='int'>60</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_session_expiry'>session_expiry</span> <span class='op'>=</span> <span class='int'>900</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_success_key'>success_key</span> <span class='op'>=</span> <span class='symbol'>:success</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_token_bytes'>token_bytes</span> <span class='op'>=</span> <span class='int'>16</span>
<span class='kw'>end</span></code></pre>
    
  </div>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>config</span>
      
      
        <span class='type'>(<tt>Struct</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Mutable Struct initialised to default config.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>void</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="CryptIdent/Config.html" title="CryptIdent::Config (class)">CryptIdent::Config</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Required Authentication Status:</p>
<ul class="authenticated">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Irrelevant; normally called during framework setup.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Session Data Interacted With:</p>
<ul class="session_data">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Irrelevant; normally called during framework setup.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Ubiquitous Language Terms:</p>
<ul class="ubiq_lang">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>None; only related to demonstrated configuration settings.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crypt_ident.rb', line 58</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_configure_crypt_ident'>configure_crypt_ident</span>
  <span class='id identifier rubyid_config'>config</span> <span class='op'>=</span> <span class='id identifier rubyid__starting_config'>_starting_config</span>
  <span class='kw'>yield</span> <span class='id identifier rubyid_config'>config</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='ivar'>@cryptid_config</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="CryptIdent/Config.html" title="CryptIdent::Config (class)">Config</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_crypt_ident_config-class_method">
  
    .<strong>reset_crypt_ident_config</strong>  &#x21d2; <tt><span class='object_link'><a href="CryptIdent/Config.html" title="CryptIdent::Config (class)">CryptIdent::Config</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Reset configuration information to default values.</p>

<p>This <strong>should</strong> primarily be used during testing, and would normally be run
from a <code>before</code> block for a test suite.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Show how a modified configuration value is reset.</p>
</div></p>
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="CryptIdent (module)">CryptIdent</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure_crypt_ident'><span class='object_link'><a href="#configure_crypt_ident-class_method" title="CryptIdent.configure_crypt_ident (method)">configure_crypt_ident</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_hashing_cost'>hashing_cost</span> <span class='op'>=</span> <span class='int'>20</span> <span class='comment'># default 8
</span><span class='kw'>end</span>
<span class='comment'># ...
</span><span class='id identifier rubyid_foo'>foo</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="CryptIdent (module)">CryptIdent</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure_crypt_ident'><span class='object_link'><a href="#configure_crypt_ident-class_method" title="CryptIdent.configure_crypt_ident (method)">configure_crypt_ident</a></span></span><span class='period'>.</span><span class='id identifier rubyid_hashing_cost'>hashing_cost</span> <span class='comment'># 20
</span><span class='comment'># ...
</span><span class='const'><span class='object_link'><a href="" title="CryptIdent (module)">CryptIdent</a></span></span><span class='period'>.</span><span class='id identifier rubyid_reset_crypt_ident_config'>reset_crypt_ident_config</span>
<span class='id identifier rubyid_foo'>foo</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="" title="CryptIdent (module)">CryptIdent</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure_crypt_ident'><span class='object_link'><a href="#configure_crypt_ident-class_method" title="CryptIdent.configure_crypt_ident (method)">configure_crypt_ident</a></span></span><span class='period'>.</span><span class='id identifier rubyid_hashing_cost'>hashing_cost</span> <span class='comment'># default, 8</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="CryptIdent/Config.html" title="CryptIdent::Config (class)">CryptIdent::Config</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Required Authentication Status:</p>
<ul class="authenticated">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Irrelevant; normally called during framework setup.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Session Data Interacted With:</p>
<ul class="session_data">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Irrelevant; normally called during testing</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Ubiquitous Language Terms:</p>
<ul class="ubiq_lang">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>None; only related to demonstrated configuration settings.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crypt_ident.rb', line 96</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_reset_crypt_ident_config'>reset_crypt_ident_config</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_cryptid_config'>cryptid_config</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="CryptIdent/Config.html" title="CryptIdent::Config (class)">Config</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="change_password-instance_method">
  
    #<strong>change_password</strong>(user, current_password, new_password, repo: nil)  &#x21d2; <tt>User</tt>, <tt>Symbol</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Change an Authenticated User&#39;s password.</p>

<p>To change an Authenticated User&#39;s password, an Entity for that User, the
current Clear-Text Password, and the new Clear-Text Password are required.
The method accepts an optional <code>repo</code> parameter to specify a Repository
instance to which the updated User Entity should be persisted; if none is
specified (i.e., if the parameter has its default value of <code>nil</code>), then the
<code>UserRepository</code> specified in the Configuration is used.</p>

<p>If the passed-in <code>user</code> is the Guest User (or <code>nil</code>), the method returns
<code>:invalid_user</code> and no further action is taken.</p>

<p>If the specified current Clear-Text Password cannot Authenticate against the
encrypted value within the <code>user</code> Entity, then the method returns
<code>:bad_password</code> and no further action is taken.</p>

<p>If these checks pass, then a new Entity, identical to the passed-in <code>user</code>
<em>except</em> having a new value for its <code>password_hash</code>, is persisted to the
Repository specified either by the <code>repo</code> parameter or, if that is <code>nil</code>,
then the default Repository specified in the default configuration.</p>

<p>If that Entity is successfully persisted, then this method will return that
Entity. If persistence fails, a <code>:repository_error</code> Symbol is returned to
indicate the error.</p>

<p>Reek complains that this is a :reek:UtilityFunction. No state needed.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>for a Controller Action Class</p>
</div></p>
      
      <pre class="example code"><code><span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:current_user</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_change_password'>change_password</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:password</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:new_password</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@user</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span> <span class='kw'>if</span> <span class='id identifier rubyid_result_ok?'>result_ok?</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_private'>private</span>

<span class='const'>BAD_PASSWORD_MESSAGE</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Invalid current password supplied.</span><span class='tstring_end'>&#39;</span></span>
<span class='const'>INVALID_USER_MESSAGE</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Not an Authenticated User.</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_private_constant'>private_constant</span> <span class='symbol'>:BAD_PASSWORD_MESSAGE</span><span class='comma'>,</span> <span class='symbol'>:INVALID_USER_MESSAGE</span>

<span class='kw'>def</span> <span class='id identifier rubyid_result_ok?'>result_ok?</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="CryptIdent (module)">CryptIdent</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure_crypt_ident'><span class='object_link'><a href="#configure_crypt_ident-class_method" title="CryptIdent.configure_crypt_ident (method)">configure_crypt_ident</a></span></span><span class='period'>.</span><span class='id identifier rubyid_error_key'>error_key</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_result'>result</span>
  <span class='kw'>when</span> <span class='symbol'>:bad_password</span> <span class='kw'>then</span> <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>BAD_PASSWORD_MESSAGE</span>
  <span class='kw'>when</span> <span class='symbol'>:invalid_user</span> <span class='kw'>then</span> <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>INVALID_USER_MESSAGE</span>
  <span class='kw'>else</span> <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
  <span class='kw'>false</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>user</span>
      
      
        <span class='type'>(<tt>User</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The User Entity from which to get the valid Encrypted
Password and other non-Password attributes</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>current_password</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The current Clear-Text Password for the
specified Current User</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>new_password</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The new Clear-Text Password to encrypt and add
to the returned Entity</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>repo</span>
      
      
        <span class='type'>(<tt>Object</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The Repository to which the updated User Entity is
to be persisted. If the default value of <code>nil</code>, then the
UserRepository specified in the default configuration is
used.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>User</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A User Entity with a new Encrypted Password value on
success, or a symbolic error identifier on failure.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Required Authentication Status:</p>
<ul class="authenticated">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Must Authenticate.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Session Data Interacted With:</p>
<ul class="session_data">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Implies that <code>:current_user</code> <strong>must</strong> be an Entity for a Registered User</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Ubiquitous Language Terms:</p>
<ul class="ubiq_lang">
  
    <li>
      
      
      
      
        
        <div class='inline'><ul>
<li>Authentication</li>
<li>Clear-Text Password</li>
<li>Encrypted Password</li>
<li>Entity</li>
<li>Guest User</li>
<li>Registered User</li>
<li>Repository</li>
</ul>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


392
393
394
395
396</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crypt_ident.rb', line 392</span>

<span class='kw'>def</span> <span class='id identifier rubyid_change_password'>change_password</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_current_password'>current_password</span><span class='comma'>,</span> <span class='id identifier rubyid_new_password'>new_password</span><span class='comma'>,</span> <span class='label'>repo:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='const'>ChangePassword</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>config:</span> <span class='const'><span class='object_link'><a href="" title="CryptIdent (module)">CryptIdent</a></span></span><span class='period'>.</span><span class='id identifier rubyid_cryptid_config'>cryptid_config</span><span class='comma'>,</span> <span class='label'>repo:</span> <span class='id identifier rubyid_repo'>repo</span><span class='comma'>,</span>
                     <span class='label'>user:</span> <span class='id identifier rubyid_user'>user</span><span class='rparen'>)</span>
                <span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_current_password'>current_password</span><span class='comma'>,</span> <span class='id identifier rubyid_new_password'>new_password</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="generate_reset_token-instance_method">
  
    #<strong>generate_reset_token</strong>(user_name)  &#x21d2; <tt>Symbol</tt>, <tt>true</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Request a Password Reset Token</p>

<p>Password Reset Tokens are useful for verifying that the person requesting a
Password Reset for an existing User is sufficiently likely to be the person
who Registered that User or, if not, that no compromise or other harm is
done.</p>

<p>Typically, this is done by sending a link through email or other such medium
to the address previously associated with the User purportedly requesting
the Password Reset. <code>CryptIdent</code> <em>does not</em> automate generation or sending
of the email message. What it <em>does</em> provide is a method to generate a new
Password Reset Token to be embedded into an HTML anchor link within an email
that you construct.</p>

<p>It also implements an expiry system, such that if the confirmation of the
Password Reset request is not completed within a configurable time, that the
token is no longer valid (and so cannot be later reused by unauthorised
persons).</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_send_reset_email'>send_reset_email</span> <span class='kw'>if</span> <span class='id identifier rubyid_valid_request?'>valid_request?</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_private'>private</span>

<span class='kw'>def</span> <span class='id identifier rubyid_send_result_email'>send_result_email</span>
  <span class='comment'># will use @user_name and @token to generate and send email
</span><span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_request?'>valid_request?</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logged_in_error'>logged_in_error</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Cannot request password reset while logged in!</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_not_found_error'>not_found_error</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Cannot find specified user in repository</span><span class='tstring_end'>&#39;</span></span>
  <span class='ivar'>@user_name</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Unknown User</span><span class='tstring_end'>&#39;</span></span>
  <span class='ivar'>@token</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_generate_reset_token'>generate_reset_token</span><span class='lparen'>(</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:user_logged_in</span> <span class='kw'>then</span> <span class='id identifier rubyid_error!'>error!</span><span class='lparen'>(</span><span class='id identifier rubyid_logged_in_error'>logged_in_error</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:user_not_found</span> <span class='kw'>then</span> <span class='id identifier rubyid_error!'>error!</span><span class='lparen'>(</span><span class='id identifier rubyid_not_found_error'>not_found_error</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>user_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The name of the User for whom a Password Reset
Token is to be generated.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>, <tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>True on success or error identifier on failure.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Required Authentication Status:</p>
<ul class="authenticated">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Must not be Authenticated.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Session Data Interacted With:</p>
<ul class="session_data">
  
    <li>
      
      
      
      
        
        <div class='inline'><p><code>:current_user</code> <strong>must not</strong> be other than <code>nil</code> or the Guest User.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Ubiquitous Language Terms:</p>
<ul class="ubiq_lang">
  
    <li>
      
      
      
      
        
        <div class='inline'><ul>
<li>Authentication</li>
<li>Password Reset Token</li>
<li>Registered User</li>
</ul>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


451
452
453</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crypt_ident.rb', line 451</span>

<span class='kw'>def</span> <span class='id identifier rubyid_generate_reset_token'>generate_reset_token</span><span class='lparen'>(</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rparen'>)</span>
  <span class='comment'># To be implemented.
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_password-instance_method">
  
    #<strong>reset_password</strong>(token, new_password, confirmation)  &#x21d2; <tt>Symbol</tt>, <tt>true</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'><p>FIXME: API and docs <em>not yet finalised!</em></p>
</div>
  </div>

<p>Reset the password for the User associated with a Password Reset Token.</p>

<p>After a Password Reset Token has been
<a href="#generate_reset_token-instance_method">generated</a> to a User, that User
would then exercise the Client system and perform a Password Reset.</p>

<p>Again, this differs from a
<a href="#change_password-instance-method">Change Password</a> activity since the User
in question <em>is not Authenticated</em> at the time of the action.</p>

<p>The <code>#reset_password</code> method is called with a Password Reset Token, a new
Clear-Text Password, and a Clear-Text Password Confirmation.</p>

<p>If the token is invalid or has expired, <code>reset_password</code> returns a value of
<code>:invalid_token</code>.</p>

<p>If the new password and confirmation do not match, <code>reset_password</code> returns
<code>:mismatched_password</code>.</p>

<p>If the new Clear-Text Password and its confirmation match, then the
value of that new Encrypted Password is returned, and the Repository record
for that Registered User is updated to include the new Encrypted Password.</p>

<p>In no event are session values, including the Current User, changed. After a
successful Password Reset, the User must Authenticate as usual.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_params_valid?'>params_valid?</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_success_key'>success_key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>You have reset your password. Please </span><span class='tstring_end'>&#39;</span></span> \
                              <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sign in.</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_root_path'>root_path</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_private'>private</span>

<span class='kw'>def</span> <span class='id identifier rubyid_params_valid?'>params_valid?</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_invalid_token_error'>invalid_token_error</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Invalid or expired token. Request reset again.</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_mismatch_error'>mismatch_error</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>New password and confirmation do not match</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_reset_password'>reset_password</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:token</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:new_password</span><span class='rbracket'>]</span><span class='comma'>,</span>
                          <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:confirmation</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_result'>result</span>
  <span class='kw'>when</span> <span class='symbol'>:invalid_token</span> <span class='kw'>then</span> <span class='id identifier rubyid_error!'>error!</span><span class='lparen'>(</span><span class='id identifier rubyid_invalid_token_error'>invalid_token_error</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:mismatched_password</span> <span class='kw'>then</span> <span class='id identifier rubyid_error!'>error!</span><span class='lparen'>(</span><span class='id identifier rubyid_mismatch_error'>mismatch_error</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>token</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The Password Reset Token previously communicated to
the User.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>new_password</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>New Clear-Text Password to encrypt and add to
return value</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>confirmation</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Clear-Text Password Confirmation.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>, <tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>True on success or error identifier on failure.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Required Authentication Status:</p>
<ul class="authenticated">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Must not be Authenticated.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Session Data Interacted With:</p>
<ul class="session_data">
  
    <li>
      
      
      
      
        
        <div class='inline'><p><code>:current_user</code> <strong>must not</strong> be other than <code>nil</code> or the Guest User.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Ubiquitous Language Terms:</p>
<ul class="ubiq_lang">
  
    <li>
      
      
      
      
        
        <div class='inline'><ul>
<li>Authentication</li>
<li>Clear-Text Password</li>
<li>Clear-Text Password Confirmation</li>
<li>Encrypted Password</li>
<li>Password Reset Token</li>
<li>Registered User</li>
</ul>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


521
522
523</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crypt_ident.rb', line 521</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_password'>reset_password</span><span class='lparen'>(</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_new_password'>new_password</span><span class='comma'>,</span> <span class='id identifier rubyid_confirmation'>confirmation</span><span class='rparen'>)</span>
  <span class='comment'># To be implemented.
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="restart_session_counter-instance_method">
  
    #<strong>restart_session_counter</strong>  
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'><p>FIXME: API and docs <em>not yet finalised!</em></p>
</div>
  </div>

<p class="note returns_void">This method returns an undefined value.</p><p>Restart the Session Expiration timestamp mechanism, to avoid prematurely
signing out a User.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='kw'>def</span> <span class='id identifier rubyid_validate_session'>validate_session</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_restart_session_counter'>restart_session_counter</span> <span class='kw'>unless</span> <span class='id identifier rubyid_session_expired?'>session_expired?</span>

  <span class='comment'># ... sign out and redirect appropriately ...
</span><span class='kw'>end</span></code></pre>
    
  </div>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Required Authentication Status:</p>
<ul class="authenticated">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Must be Authenticated.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Session Data Interacted With:</p>
<ul class="session_data">
  
    <li>
      
      
      
      
        
        <div class='inline'><p><code>:current_user</code> <strong>must</strong> be an Entity for a Registered User on entry
<code>:start_time</code>   set to <code>Time.now</code> on exit</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Ubiquitous Language Terms:</p>
<ul class="ubiq_lang">
  
    <li>
      
      
      
      
        
        <div class='inline'><ul>
<li>Authentication</li>
<li>Session Expiration</li>
</ul>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


547
548
549</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crypt_ident.rb', line 547</span>

<span class='kw'>def</span> <span class='id identifier rubyid_restart_session_counter'>restart_session_counter</span>
  <span class='comment'># To be implemented.
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="session_expired?-instance_method">
  
    #<strong>session_expired?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'><p>FIXME: API and docs <em>not yet finalised!</em></p>
</div>
  </div>

<p>Determine whether the Session has Expired due to User inactivity.</p>

<p>This is determined by comparing the current time as reported by <code>Time.now</code>
to the timestamp resulting from adding <code>session[:start_time]</code> and
<code>config.session_expiry</code>.</p>

<p>Will return <code>false</code> if <code>session[:current_user]</code> is <code>nil</code> or has the value
specified by <code>config.guest_user</code>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='kw'>def</span> <span class='id identifier rubyid_validate_session'>validate_session</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_restart_session_counter'>restart_session_counter</span> <span class='kw'>unless</span> <span class='id identifier rubyid_session_expired?'>session_expired?</span>

  <span class='comment'># ... sign out and redirect appropriately ...
</span><span class='kw'>end</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Required Authentication Status:</p>
<ul class="authenticated">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Must be Authenticated.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Session Data Interacted With:</p>
<ul class="session_data">
  
    <li>
      
      
      
      
        
        <div class='inline'><p><code>:current_user</code> <strong>must</strong> be an Entity for a Registered User on entry
<code>:start_time</code>   read during determination of expiry status</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Ubiquitous Language Terms:</p>
<ul class="ubiq_lang">
  
    <li>
      
      
      
      
        
        <div class='inline'><ul>
<li>Authentication</li>
<li>Session Expiration</li>
</ul>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


577
578
579</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crypt_ident.rb', line 577</span>

<span class='kw'>def</span> <span class='id identifier rubyid_session_expired?'>session_expired?</span>
  <span class='comment'># To be implemented.
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sign_in-instance_method">
  
    #<strong>sign_in</strong>(user, password, current_user: nil)  &#x21d2; <tt>User</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Attempt to Authenticate a User, passing in an Entity for that User (which
<strong>must</strong> contain a <code>password_hash</code> attribute), and a Clear-Text Password.
It also passes in the Current User.</p>

<p>If the Current User is either <code>nil</code> or the Guest User, then Authentication
of the specified User Entity against the specified Password proceeds as
follows: The User Entity&#39;s <code>password_hash</code> attribute is used to attempt a
match against the passed-in Clear-Text Password. If and only if a match is
determined, the passed-in User Entity is returned, indicating success.
Otherwise, the method returns <code>nil</code>.</p>

<p>If the Current User is the <em>same</em> User as that in the specified User Entity
(as compared by their attributes being equal), then Authentication proceeds
normally; if the incorrect Password is specified, the method will return
<code>nil</code> (and its client code can determine what to do from there).</p>

<p>If the Current User is a User <em>other than</em> the Guest User or the User Entity
passed in, the method returns <code>nil</code> without attempting to Authenticate the
Clear-Text Password.</p>

<p>On <em>success,</em> the Controller-level client code <strong>must</strong> set:</p>

<ul>
<li><code>session[:start_time]</code> to the current time as returned by <code>Time.now</code>;</li>
<li><code>session[:current_user]</code> to tne returned <em>Entity</em> for the successfully
Authenticated User. This is to eliminate possible repeated reads of the
Repository.</li>
</ul>

<p>On <em>failure,</em> the Controller-level client code <strong>should</strong> set:</p>

<ul>
<li><code>session[:start_time]</code> to some sufficiently-past time to <em>always</em> trigger
<code>#session_expired?</code>; <code>Hanami::Utils::Kernel.Time(0)</code> does this quite well
(returning midnight GMT on 1 January 1970, converted to local time).</li>
<li><code>session[:current_user]</code> to <code>nil</code> or the Guest User.</li>
</ul>

<hr>

<p>Reek complains that this is a :reek:UtilityFunction. No state needed.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>As in a Controller Action Class (which you&#39;d refactor somewhat):</p>
</div></p>
      
      <pre class="example code"><code><span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>UserRepository</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_find_by_email'>find_by_email</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:email</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_guest_user'>guest_user</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="CryptIdent (module)">CryptIdent</a></span></span><span class='op'>::</span><span class='id identifier rubyid_configure_crypt_ident'><span class='object_link'><a href="#configure_crypt_ident-class_method" title="CryptIdent.configure_crypt_ident (method)">configure_crypt_ident</a></span></span><span class='period'>.</span><span class='id identifier rubyid_guest_user'>guest_user</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_update_session_data'>update_session_data</span><span class='lparen'>(</span><span class='id identifier rubyid_guest_user'>guest_user</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_user'>user</span>

  <span class='ivar'>@user</span> <span class='op'>=</span> <span class='id identifier rubyid_sign_in'>sign_in</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:password</span><span class='rbracket'>]</span><span class='comma'>,</span>
                  <span class='label'>current_user:</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:current_user</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@user</span>
    <span class='id identifier rubyid_update_session_data'>update_session_data</span><span class='lparen'>(</span><span class='ivar'>@user</span><span class='comma'>,</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_update_session_data'>update_session_data</span><span class='lparen'>(</span><span class='id identifier rubyid_guest_user'>guest_user</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_private'>private</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_session_data'>update_session_data</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_time'>time</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:current_user</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span>
  <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:start_time</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='const'>Hanami</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Kernel</span><span class='period'>.</span><span class='const'>Time</span><span class='lparen'>(</span><span class='id identifier rubyid_time'>time</span><span class='rparen'>)</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>user</span>
      
      
        <span class='type'>(<tt>User</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Entity representing a User to be Authenticated.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>password</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Claimed Clear-Text Password for the specified User.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>current_user</span>
      
      
        <span class='type'>(<tt>User</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Entity representing the currently
Authenticated User Entity; either <code>nil</code> or the Guest User if
none.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>User</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>See method descriptive text.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Required Authentication Status:</p>
<ul class="authenticated">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Must not be Authenticated as a different User.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Session Data Interacted With:</p>
<ul class="session_data">
  
    <li>
      
      
      
      
        
        <div class='inline'><p><code>:current_user</code> <strong>must not</strong> be other than <code>nil</code> or the Guest User.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Ubiquitous Language Terms:</p>
<ul class="ubiq_lang">
  
    <li>
      
      
      
      
        
        <div class='inline'><ul>
<li>Authenticated User</li>
<li>Authentication</li>
<li>Clear-Text Password</li>
<li>Entity</li>
<li>Guest User</li>
<li>User</li>
</ul>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


251
252
253</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crypt_ident.rb', line 251</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sign_in'>sign_in</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='label'>current_user:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='const'>SignIn</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='label'>user:</span> <span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='label'>password:</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='label'>current_user:</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sign_out-instance_method">
  
    #<strong>sign_out</strong>(&amp;_block) {|config| ... } 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Sign out a previously Authenticated User.</p>

<p>The block is <em>required</em> for this method; in it, you should either delete or
reset the <code>session[:current_user]</code> and <code>session[:start_time]</code> variables.</p>

<p>If resetting the values, we <strong>recommend</strong> they be set to</p>

<ul>
<li><code>CryptIdent.configure_crypt_ident.guest_user</code> for
<code>session[:current_user]</code> and</li>
<li><code>Hanami::Utils::Kernel.Time(0)</code> for <code>session[:start_time]</code>, which will set
the timestamp to midnight on 1 January 1970 -- a value which should <em>far</em>
exceed your session-expiry limit.</li>
</ul>

<p>Calling this method when no Current User has been Authenticated is virtually
idempotent; the only changes will be if you had reset session data in one
call and deleted it in the other, or vice versa. Either <strong>should not</strong> have
any impact on your application.</p>

<hr>

<p>Reek complains that this is a :reek:UtilityFunction. No state needed.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Controller Action Class method example resetting values</p>
</div></p>
      
      <pre class="example code"><code><span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid__params'>_params</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sign_out'>sign_out</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:current_user</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="CryptIdent (module)">CryptIdent</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure_crypt_ident'><span class='object_link'><a href="#configure_crypt_ident-class_method" title="CryptIdent.configure_crypt_ident (method)">configure_crypt_ident</a></span></span><span class='period'>.</span><span class='id identifier rubyid_guest_user'>guest_user</span>
    <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:start_time</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Hanami</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Kernel</span><span class='period'>.</span><span class='const'>Time</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Controller Action Class method example deleting values</p>
</div></p>
      
      <pre class="example code"><code><span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid__params'>_params</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sign_out'>sign_out</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:current_user</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:start_time</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>_block</span>
      
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Required block which will always be called; see
earlier description.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>config</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="CryptIdent/Config.html" title="CryptIdent::Config (class)">Config</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Immutable CryptIdent::Config instance with
currently-active configuration values.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>void</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Required Authentication Status:</p>
<ul class="authenticated">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Should be Authenticated.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Session Data Interacted With:</p>
<ul class="session_data">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>See method description above.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Ubiquitous Language Terms:</p>
<ul class="ubiq_lang">
  
    <li>
      
      
      
      
        
        <div class='inline'><ul>
<li>Authenticated User</li>
<li>Authentication</li>
<li>Controller Action Class</li>
<li>Entity</li>
<li>Guest User</li>
<li>Interactor</li>
<li>Repository</li>
</ul>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


313
314
315</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crypt_ident.rb', line 313</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sign_out'>sign_out</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid__block'>_block</span><span class='rparen'>)</span>
  <span class='kw'>yield</span> <span class='const'><span class='object_link'><a href="" title="CryptIdent (module)">CryptIdent</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure_crypt_ident'><span class='object_link'><a href="#configure_crypt_ident-class_method" title="CryptIdent.configure_crypt_ident (method)">configure_crypt_ident</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sign_up-instance_method">
  
    #<strong>sign_up</strong>(attribs, current_user:, repo: nil, on_error: nil, &amp;_on_success)  &#x21d2; <tt>User</tt>, <tt>Symbol</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Persist a new User to a Repository based on passed-in attributes, with a
<code>:password_hash</code> attribute containing the encrypted value of the Clear-Text
Password passed in as the <code>password</code> attribute.</p>

<p>On success, the block is yielded to with two parameters: <code>user</code>, an Entity
representing the contents of the newly-added record in the Repository, and
<code>cryptid_config</code>, which contains the data in the CryptIdent configuration,
such as <code>success_key</code> and <code>error_key</code>. Any value returned from the block <em>is
not</em> preserved. Rather, the method returns the same Entity passed into the
block as <code>user</code>. The block <strong>should</strong> assign to the exposed <code>@user</code> instance
variable, as well as any other side-effects (logging, etc) that are
appropriate.</p>

<p>On failure, the block <em>is not</em> yielded to, and the method returns a Symbol
designating the cause of the failure. This will be one of the following:</p>

<ul>
<li>If <code>#sign_up</code> was called with a <code>current_user</code> parameter that was not
<code>nil</code> or the Guest User, it returns <code>:current_user_exists</code>;</li>
<li>If the specified <code>name</code> attribute value matches a record that already
exists in the Repository, the return value is <code>:user_already_created</code>;</li>
<li>If a record containing the specified attributes could not be created in
the Repository, this method returns <code>:user_creation_failed</code>.</li>
</ul>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid__params'>_params</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_call_params'>call_params</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>current_user:</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:current_user</span><span class='rbracket'>]</span><span class='comma'>,</span>
              <span class='label'>on_error:</span> <span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:report_errors</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sign_up'>sign_up</span><span class='lparen'>(</span><span class='id identifier rubyid_call_params'>call_params</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_cryptident_config'>cryptident_config</span><span class='op'>|</span>
    <span class='ivar'>@user</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span>
    <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:current_user</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> successfully created. You may sign in now.</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='id identifier rubyid_cryptident_config'>cryptident_config</span><span class='period'>.</span><span class='id identifier rubyid_success_key'>success_key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_message'>message</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_routes'>routes</span><span class='period'>.</span><span class='id identifier rubyid_root_path'>root_path</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>attribs</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Hash-like object of attributes for new User Entity and
record, confirming to
<strong>Must</strong> include <code>name</code> and  any other attributes required by
the underlying database schema, as well as a (clear-text)
<code>password</code> attribute which will be replaced in the created
Entity/record by a <code>password_hash</code> attribute.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>current_user</span>
      
      
        <span class='type'>(<tt>User</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Entity representing the current Authenticated
User, or the Guest User. A value of <code>nil</code> is treated as though
the Guest User had been specified.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>repo</span>
      
      
        <span class='type'>(<tt>Hanami::Repository</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Repository to be used for accessing User
data. A value of <code>nil</code> indicates that the default Repository
specified in the Configuration should be used.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>on_error</span>
      
      
        <span class='type'>(<tt>Method</tt>, <tt>Proc</tt>, <tt>`nil`</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The method or Proc to be called in
case of an error, or <code>nil</code> if none is defined.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>_on_success</span>
      
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Block containing code to be called on success;
see earlier description.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>User</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Entity representing created User on success, or a
Symbol identifying the reason for failure.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Required Authentication Status:</p>
<ul class="authenticated">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Must not be Authenticated.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Session Data Interacted With:</p>
<ul class="session_data">
  
    <li>
      
      
      
      
        
        <div class='inline'><p><code>:current_user</code> <strong>must not</strong> be other than <code>nil</code> or the Guest User.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Ubiquitous Language Terms:</p>
<ul class="ubiq_lang">
  
    <li>
      
      
      
      
        
        <div class='inline'><ul>
<li>Authentication</li>
<li>Clear-Text Password</li>
<li>Entity</li>
<li>Guest User</li>
<li>Repository</li>
<li>User</li>
</ul>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


167
168
169
170
171
172
173</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crypt_ident.rb', line 167</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sign_up'>sign_up</span><span class='lparen'>(</span><span class='id identifier rubyid_attribs'>attribs</span><span class='comma'>,</span> <span class='label'>current_user:</span><span class='comma'>,</span> <span class='label'>repo:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>on_error:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid__on_success'>_on_success</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='symbol'>:current_user_exists</span> <span class='kw'>if</span> <span class='id identifier rubyid_current_user'>current_user</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_guest_user?'>guest_user?</span>

  <span class='const'>SignUp</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_repo'>repo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_attribs'>attribs</span><span class='comma'>,</span> <span class='label'>on_error:</span> <span class='id identifier rubyid_on_error'>on_error</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_ci_conf'>ci_conf</span><span class='op'>|</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_ci_conf'>ci_conf</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Nov 24 19:04:08 2018 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.16 (ruby-2.5.3).
</div>

    </div>
  </body>
</html>