<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: crypt_ident
  
    &mdash; Documentation by YARD 0.9.16
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "crypt_ident";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: crypt_ident</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><pre class="code ruby"><span class='comment'># frozen_string_literal: true
</span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>crypt_ident/version</span><span class='tstring_end'>&#39;</span></span>

<span class='comment'># Include and interact with `CryptIdent` to add authentication to a
</span><span class='comment'># Hanami controller action.
</span><span class='comment'>#
</span><span class='comment'># Note the emphasis on *controller action*; this module interacts with session
</span><span class='comment'># data, which is quite theoretically possible in an Interactor but practically
</span><span class='comment'># *quite* the PITA. YHBW.
</span><span class='comment'>#
</span><span class='comment'># @author Jeff Dickey
</span><span class='comment'># @version 0.1.0
</span><span class='kw'>module</span> <span class='const'><span class='object_link'><a href="CryptIdent.html" title="CryptIdent (module)">CryptIdent</a></span></span>
  <span class='comment'># Set configuration information at the class (actually, module) level.
</span>  <span class='comment'>#
</span>  <span class='comment'># **IMPORTANT:** Even though we follow time-honoured convention
</span>  <span class='comment'># here and call the variable yielded by the `CryptIdent.configure_crypt_ident`
</span>  <span class='comment'># block `config`, settings *are not* being stored in an *instance variable*
</span>  <span class='comment'># called `@config`. That is *too likely* to conflict with something Important;
</span>  <span class='comment'># remember, we&#39;re a module, not a class, and good table manners are *also*
</span>  <span class='comment'># Important.
</span>  <span class='comment'>#
</span>  <span class='comment'># This is normally run from the `controller.prepare` block inside your app&#39;s
</span>  <span class='comment'># `apps/&lt;app name&gt;/application.rb` file, where the default for `app_name` in a
</span>  <span class='comment'># Hanami app is `web`.
</span>  <span class='comment'>#
</span>  <span class='comment'># @since 0.1.0
</span>  <span class='comment'># @authenticated Irrelevant; normally called during framework setup.
</span>  <span class='comment'># @return (void)
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   CryptIdent.configure_crypt_ident do |config|
</span>  <span class='comment'>#     config.repository = MainApp::Repositories::User.new
</span>  <span class='comment'>#     config.error_key = :alert
</span>  <span class='comment'>#     config.hashing_cost = 6 # less secure and less resource-intensive
</span>  <span class='comment'>#     config.token_bytes = 20
</span>  <span class='comment'>#     config.reset_expiry = 7200 # two hours; &quot;we run a tight ship here&quot;
</span>  <span class='comment'>#     config.guest_user = UserRepository.new.guest_user
</span>  <span class='comment'>#   end
</span>  <span class='comment'># @session_data Irrelevant; normally called during framework setup.
</span>  <span class='comment'># @ubiq_lang None; only related to demonstrated configuration settings.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_configure_crypt_ident'>configure_crypt_ident</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>############################################################################ #
</span>
  <span class='comment'># Build a Hash of attributes suitable for instantiating and persisting an
</span>  <span class='comment'># Entity, with a `:hashed_password` attribute containing the encrypted value
</span>  <span class='comment'># of the Clear-Text Password passed in as a parameter.
</span>  <span class='comment'>#
</span>  <span class='comment'># @since 0.1.0
</span>  <span class='comment'># @authenticated Must not be authenticated.
</span>  <span class='comment'># @param [Hash] other_params Hash of Entity attributes *not* including
</span>  <span class='comment'>#               any password attributes.
</span>  <span class='comment'># @param [String] password New Clear-Text Password to encrypt and add to
</span>  <span class='comment'>#                 return value
</span>  <span class='comment'># @return [Hash] Entity attributes, including encrypted `password_hash`.
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   def call(params) # #valid? has already returned `true`
</span>  <span class='comment'>#     password = params[:password]
</span>  <span class='comment'>#     others = params.reject { |k, _| k == :password }
</span>  <span class='comment'>#     attribs = add_password(others, password)
</span>  <span class='comment'>#     config.repo.create(attribs)
</span>  <span class='comment'>#   end
</span>  <span class='comment'># @session_data
</span>  <span class='comment'>#   `:current_user` **must not** be other than `nil` or the Guest User.
</span>  <span class='comment'># @ubiq_lang
</span>  <span class='comment'>#   - Authentication
</span>  <span class='comment'>#   - Clear-Text Password
</span>  <span class='comment'>#   - Entity
</span>  <span class='comment'>#   - Guest User
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_add_password'>add_password</span><span class='lparen'>(</span><span class='id identifier rubyid_other_params'>other_params</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Attempt to Authenticate a User, passing in an Entity for that User (which
</span>  <span class='comment'># **must** contain a `password_hash` attribute), and a Clear-Text Password.
</span>  <span class='comment'>#
</span>  <span class='comment'># On *success:*
</span>  <span class='comment'>#
</span>  <span class='comment'># * `session[:start_time]` is set to the current time as returned by
</span>  <span class='comment'>#   `Time.now` when called from within the method;
</span>  <span class='comment'># * `session[:current_user]` is set to tne *Entity* (not the ID value from the
</span>  <span class='comment'>#   Repository) for the successfully-Authenticated User. This is to eliminate
</span>  <span class='comment'>#   repeated reads of the Repository.
</span>  <span class='comment'>#
</span>  <span class='comment'># On *failure:*
</span>  <span class='comment'>#
</span>  <span class='comment'># * `session[:start_time]` is set to `0000-01-01 00:00:00 +0000` (which should
</span>  <span class='comment'>#   *always* trigger `#session_expired?`)
</span>  <span class='comment'># * `session[:current_user]` is set to `config.guest_user`
</span>  <span class='comment'>#
</span>  <span class='comment'># If a *different User* is Authenticated (as evidenced by
</span>  <span class='comment'># `session[:current_user]`), then `sign_in` returns `false` and the `session`
</span>  <span class='comment'># data remains unchanged.
</span>  <span class='comment'>#
</span>  <span class='comment'># @since 0.1.0
</span>  <span class='comment'># @authenticated Must not be authenticated.
</span>  <span class='comment'># @param [Object] user Entity representing a User to be Authenticated;
</span>  <span class='comment'># @param [String] password Claimed Clear-Text Password for the specified User.
</span>  <span class='comment'># @return [Boolean]
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   def initialize(config)
</span>  <span class='comment'>#     @config = config
</span>  <span class='comment'>#   end
</span>  <span class='comment'>#
</span>  <span class='comment'>#   def call(params)
</span>  <span class='comment'>#     true
</span>  <span class='comment'>#   end
</span>  <span class='comment'>#
</span>  <span class='comment'>#   def valid?(params)
</span>  <span class='comment'>#     user = UserRepository.new.find_by_email(params[:email])
</span>  <span class='comment'>#     @user = user || @config.guest_user
</span>  <span class='comment'>#     return false unless user
</span>  <span class='comment'>#     sign_in(@user, params[:password])
</span>  <span class='comment'>#   end
</span>  <span class='comment'># @session_data
</span>  <span class='comment'>#   `:current_user` **must not** be other than `nil` or the Guest User.
</span>  <span class='comment'>#
</span>  <span class='comment'>#   `:start_time` is set to either the current time (on success) or the
</span>  <span class='comment'>#     distant past (on failure)
</span>  <span class='comment'># @ubiq_lang
</span>  <span class='comment'>#   - Authenticated User
</span>  <span class='comment'>#   - Authentication
</span>  <span class='comment'>#   - Clear-Text Password
</span>  <span class='comment'>#   - Entity
</span>  <span class='comment'>#   - Guest User
</span>  <span class='comment'>#   - Repository
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_sign_in'>sign_in</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Sign out a previously Authenticated User.
</span>  <span class='comment'>#
</span>  <span class='comment'># If the `session[:current_user]` value *does not* have the value of `nil` or
</span>  <span class='comment'># `config.guest_user`, then `session[:start_time]` is set to
</span>  <span class='comment'># `0000-01-01 00:00:00 +0000`, and the method returns `true`.
</span>  <span class='comment'>#
</span>  <span class='comment'># If `session[:current_user]` *is* the Guest User, then
</span>  <span class='comment'># `session[:start_time]` is cleared as above, and the method returns
</span>  <span class='comment'># `false`
</span>  <span class='comment'>#
</span>  <span class='comment'># In neither case is any data but the `session` values affected.
</span>  <span class='comment'>#
</span>  <span class='comment'># @since 0.1.0
</span>  <span class='comment'># @authenticated Must be authenticated.
</span>  <span class='comment'># @return [Boolean]
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   def call(_params)
</span>  <span class='comment'>#     true
</span>  <span class='comment'>#   end
</span>  <span class='comment'>#
</span>  <span class='comment'>#   def valid?(params)
</span>  <span class='comment'>#     @user_name = session[:current_user].name
</span>  <span class='comment'>#     sign_out
</span>  <span class='comment'>#   end
</span>  <span class='comment'>#
</span>  <span class='comment'># @session_data
</span>  <span class='comment'>#   `:current_user` **must not** be other than `nil` or the Guest User; set to
</span>  <span class='comment'>#     the Guest User value on completion;
</span>  <span class='comment'>#
</span>  <span class='comment'>#   `:start_time` is set to the distant past (on success)
</span>  <span class='comment'># @ubiq_lang
</span>  <span class='comment'>#   - Authenticated User
</span>  <span class='comment'>#   - Authentication
</span>  <span class='comment'>#   - Entity
</span>  <span class='comment'>#   - Guest User
</span>  <span class='comment'>#   - Repository
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_sign_out'>sign_out</span>
  <span class='kw'>end</span>

  <span class='comment'># Change an Authenticated User&#39;s password.
</span>  <span class='comment'>#
</span>  <span class='comment'># To change an Authenticated User&#39;s password, the current Clear-Text Password,
</span>  <span class='comment'># new Clear-Text Password, and Clear-Text Password Confirmation are passed in
</span>  <span class='comment'># as parameters.
</span>  <span class='comment'>#
</span>  <span class='comment'># If the Encrypted Password in the `session[:current_user]` Entity does
</span>  <span class='comment'># not match the encrypted value of the specified current Clear-Text Password,
</span>  <span class='comment'># then the method returns `:bad_password` and no changes occur.
</span>  <span class='comment'>#
</span>  <span class='comment'># If the current-password check succeeds but the new Clear-Text Password and
</span>  <span class='comment'># its confirmation do not match, then the method returns
</span>  <span class='comment'># `:mismatched_password` and no changes occur.
</span>  <span class='comment'>#
</span>  <span class='comment'># If the new Clear-Text Password and its confirmation match, then the
</span>  <span class='comment'># *encrypted value* of that new Password is returned, and the
</span>  <span class='comment'># `session[:current_user]` Entity is replaced with an Entity identical
</span>  <span class='comment'># except that it has the new encrypted value for `hashed_password`. The entry
</span>  <span class='comment'># in the Repository for the current User has also been updated to include the
</span>  <span class='comment'># new Encrypted Password.
</span>  <span class='comment'>#
</span>  <span class='comment'># @since 0.1.0
</span>  <span class='comment'># @authenticated Must be authenticated.
</span>  <span class='comment'># @param [String] current_password The current Clear-Text Password for the
</span>  <span class='comment'>#                                  Current User
</span>  <span class='comment'># @param [String] new_password The new Clear-Text Password to encrypt and add
</span>  <span class='comment'>#                 the current-user entity
</span>  <span class='comment'># @return [Boolean]
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   def call(params)
</span>  <span class='comment'>#     user = session[:current_user]
</span>  <span class='comment'>#     UserRepository.new.update(user.id, user) # updated user saved to repo
</span>  <span class='comment'>#   end
</span>  <span class='comment'>#
</span>  <span class='comment'>#   private
</span>  <span class='comment'>#
</span>  <span class='comment'>#   def valid?(params)
</span>  <span class='comment'>#     mismatch_message = &#39;New password and confirmation do not match.&#39;
</span>  <span class='comment'>#     result = change_password(params[:password], params[:new_password],
</span>  <span class='comment'>#                              params[:confirmation])
</span>  <span class='comment'>#     case result
</span>  <span class='comment'>#     when :bad_password then error!(&#39;Invalid current password supplied.&#39;)
</span>  <span class='comment'>#     when :mismatched_password then error!(mismatch_message)
</span>  <span class='comment'>#     end # else `session[:current_user]` has been updated
</span>  <span class='comment'>#   end
</span>  <span class='comment'>#
</span>  <span class='comment'># @session_data
</span>  <span class='comment'>#   `:current_user` **must** be an Entity for a Registered User
</span>  <span class='comment'># @ubiq_lang
</span>  <span class='comment'>#   - Authentication
</span>  <span class='comment'>#   - Clear-Text Password
</span>  <span class='comment'>#   - Clear-Text Password Confirmation
</span>  <span class='comment'>#   - Encrypted Password
</span>  <span class='comment'>#   - Entity
</span>  <span class='comment'>#   - Guest User
</span>  <span class='comment'>#   - Registered User
</span>  <span class='comment'>#   - Repository
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_change_password'>change_password</span><span class='lparen'>(</span><span class='id identifier rubyid_current_password'>current_password</span><span class='comma'>,</span> <span class='id identifier rubyid_new_password'>new_password</span><span class='comma'>,</span> <span class='id identifier rubyid_new_confirmation'>new_confirmation</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>############################################################################ #
</span>
  <span class='comment'># Request a Password Reset Token
</span>  <span class='comment'>#
</span>  <span class='comment'># Password Reset Tokens are useful for verifying that the person requesting a
</span>  <span class='comment'># Password Reset for an existing User is sufficiently likely to be the person
</span>  <span class='comment'># who Registered that User or, if not, that no compromise or other harm is
</span>  <span class='comment'># done.
</span>  <span class='comment'>#
</span>  <span class='comment'># Typically, this is done by sending a link through email or other such medium
</span>  <span class='comment'># to the address previously associated with the User purportedly requesting
</span>  <span class='comment'># the Password Reset. `CryptIdent` *does not* automate generation or sending
</span>  <span class='comment'># of the email message. What it *does* provide is a method to generate a new
</span>  <span class='comment'># Password Reset Token to be embedded into an HTML anchor link within an email
</span>  <span class='comment'># that you construct.
</span>  <span class='comment'>#
</span>  <span class='comment'># It also implements an expiry system, such that if the confirmation of the
</span>  <span class='comment'># Password Reset request is not completed within a configurable time, that the
</span>  <span class='comment'># token is no longer valid (and so cannot be later reused by unauthorised
</span>  <span class='comment'># persons).
</span>  <span class='comment'>#
</span>  <span class='comment'># @since 0.1.0
</span>  <span class='comment'># @authenticated Must not be authenticated.
</span>  <span class='comment'># @param [String] user_name The name of the User for whom a Password Reset
</span>  <span class='comment'>#                 Token is to be generated.
</span>  <span class='comment'># @return [Symbol, true] True on success or error identifier on failure.
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   def call(params)
</span>  <span class='comment'>#     send_reset_email if valid_request?
</span>  <span class='comment'>#   end
</span>  <span class='comment'>#
</span>  <span class='comment'>#   private
</span>  <span class='comment'>#
</span>  <span class='comment'>#   def send_result_email
</span>  <span class='comment'>#     # will use @user_name and @token to generate and send email
</span>  <span class='comment'>#   end
</span>  <span class='comment'>#
</span>  <span class='comment'>#   def valid_request?(params)
</span>  <span class='comment'>#     logged_in_error = &#39;Cannot request password reset while logged in!&#39;
</span>  <span class='comment'>#     not_found_error = &#39;Cannot find specified user in repository&#39;
</span>  <span class='comment'>#     @user_name = params[:name] || &#39;Unknown User&#39;
</span>  <span class='comment'>#     @token = case generate_reset_token(user_name)
</span>  <span class='comment'>#     when :user_logged_in then error!(logged_in_error)
</span>  <span class='comment'>#     when :user_not_found then error!(not_found_error)
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='comment'># @session_data
</span>  <span class='comment'>#   `:current_user` **must not** be other than `nil` or the Guest User.
</span>  <span class='comment'># @ubiq_lang
</span>  <span class='comment'>#   - Authentication
</span>  <span class='comment'>#   - Password Reset Token
</span>  <span class='comment'>#   - Registered User
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_generate_reset_token'>generate_reset_token</span><span class='lparen'>(</span><span class='id identifier rubyid_user_name'>user_name</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Reset the password for the User associated with a Password Reset Token.
</span>  <span class='comment'>#
</span>  <span class='comment'># After a Password Reset Token has been
</span>  <span class='comment'># [generated](#generate_reset_token-instance_method) to a User, that User
</span>  <span class='comment'># would then exercise the Client system and perform a Password Reset.
</span>  <span class='comment'>#
</span>  <span class='comment'># Again, this differs from a
</span>  <span class='comment'># [Change Password](#change_password-instance-method) activity since the User
</span>  <span class='comment'># in question *is not Authenticated* at the time of the action.
</span>  <span class='comment'>#
</span>  <span class='comment'># The `#reset_password` method is called with a Password Reset Token, a new
</span>  <span class='comment'># Clear-Text Password, and a Clear-Text Password Confirmation.
</span>  <span class='comment'>#
</span>  <span class='comment'># If the token is invalid or has expired, `reset_password` returns a value of
</span>  <span class='comment'># `:invalid_token`.
</span>  <span class='comment'>#
</span>  <span class='comment'># If the new password and confirmation do not match, `reset_password` returns
</span>  <span class='comment'># `:mismatched_password`.
</span>  <span class='comment'>#
</span>  <span class='comment'># If the new Clear-Text Password and its confirmation match, then the
</span>  <span class='comment'># value of that new Encrypted Password is returned, and the Repository record
</span>  <span class='comment'># for that Registered User is updated to include the new Encrypted Password.
</span>  <span class='comment'>#
</span>  <span class='comment'># In no event are session values, including the Current User, changed. After a
</span>  <span class='comment'># successful Password Reset, the User must Authenticate as usual.
</span>  <span class='comment'>#
</span>  <span class='comment'># @since 0.1.0
</span>  <span class='comment'># @authenticated Must not be authenticated.
</span>  <span class='comment'># @param [String] token The Password Reset Token previously communicated to
</span>  <span class='comment'>#                       the User.
</span>  <span class='comment'># @param [String] new_password New Clear-Text Password to encrypt and add to
</span>  <span class='comment'>#                 return value
</span>  <span class='comment'># @param [String] confirmation Clear-Text Password Confirmation.
</span>  <span class='comment'># @return [Symbol, true] True on success or error identifier on failure.
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   def call(params)
</span>  <span class='comment'>#     return unless params_valid?(params)
</span>  <span class='comment'>#
</span>  <span class='comment'>#     flash[config.success_key] = &#39;You have reset your password. Please &#39; \
</span>  <span class='comment'>#                                 &#39;sign in.&#39;
</span>  <span class='comment'>#     redirect_to config.root_path
</span>  <span class='comment'>#   end
</span>  <span class='comment'>#
</span>  <span class='comment'>#   private
</span>  <span class='comment'>#
</span>  <span class='comment'>#   def params_valid?(params)
</span>  <span class='comment'>#     invalid_token_error = &#39;Invalid or expired token. Request reset again.&#39;
</span>  <span class='comment'>#     mismatch_error = &#39;New password and confirmation do not match&#39;
</span>  <span class='comment'>#     result = reset_password(params[:token], params[:new_password],
</span>  <span class='comment'>#                             params[:confirmation])
</span>  <span class='comment'>#     case result
</span>  <span class='comment'>#     when :invalid_token then error!(invalid_token_error)
</span>  <span class='comment'>#     when :mismatched_password then error!(mismatch_error)
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='comment'># @session_data
</span>  <span class='comment'>#   `:current_user` **must not** be other than `nil` or the Guest User.
</span>  <span class='comment'># @ubiq_lang
</span>  <span class='comment'>#   - Authentication
</span>  <span class='comment'>#   - Clear-Text Password
</span>  <span class='comment'>#   - Clear-Text Password Confirmation
</span>  <span class='comment'>#   - Encrypted Password
</span>  <span class='comment'>#   - Password Reset Token
</span>  <span class='comment'>#   - Registered User
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_reset_password'>reset_password</span><span class='lparen'>(</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_new_password'>new_password</span><span class='comma'>,</span> <span class='id identifier rubyid_confirmation'>confirmation</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>############################################################################ #
</span>
  <span class='comment'># Restart the Session Expiration timestamp mechanism, to avoid prematurely
</span>  <span class='comment'># signing out a User.
</span>  <span class='comment'>#
</span>  <span class='comment'># @since 0.1.0
</span>  <span class='comment'># @authenticated Must be authenticated.
</span>  <span class='comment'># @return (void)
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   def validate_session
</span>  <span class='comment'>#     return restart_session_counter unless session_expired?
</span>  <span class='comment'>#
</span>  <span class='comment'>#     # ... sign out and redirect appropriately ...
</span>  <span class='comment'>#   end
</span>  <span class='comment'># @session_data
</span>  <span class='comment'>#   `:current_user` **must** be an Entity for a Registered User on entry
</span>  <span class='comment'>#   `:start_time`   set to `Time.now` on exit
</span>  <span class='comment'># @ubiq_lang
</span>  <span class='comment'>#   - Authentication
</span>  <span class='comment'>#   - Session Expiration
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_restart_session_counter'>restart_session_counter</span>
  <span class='kw'>end</span>

  <span class='comment'># Determine whether the Session has Expired due to User inactivity.
</span>  <span class='comment'>#
</span>  <span class='comment'># This is determined by comparing the current time as reported by `Time.now`
</span>  <span class='comment'># to the timestamp resulting from adding `session[:start_time]` and
</span>  <span class='comment'># `config.session_expiry`.
</span>  <span class='comment'>#
</span>  <span class='comment'># Will return `false` if `session[:current_user]` is `nil` or has the value
</span>  <span class='comment'># specified by `config.guest_user`.
</span>  <span class='comment'>#
</span>  <span class='comment'># @since 0.1.0
</span>  <span class='comment'># @authenticated Must be authenticated.
</span>  <span class='comment'># @return [Boolean]
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   def validate_session
</span>  <span class='comment'>#     return restart_session_counter unless session_expired?
</span>  <span class='comment'>#
</span>  <span class='comment'>#     # ... sign out and redirect appropriately ...
</span>  <span class='comment'>#   end
</span>  <span class='comment'># @session_data
</span>  <span class='comment'>#   `:current_user` **must** be an Entity for a Registered User on entry
</span>  <span class='comment'>#   `:start_time`   read during determination of expiry status
</span>  <span class='comment'># @ubiq_lang
</span>  <span class='comment'>#   - Authentication
</span>  <span class='comment'>#   - Session Expiration
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_session_expired?'>session_expired?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre></div></div>

      <div id="footer">
  Generated on Mon Oct 22 20:24:42 2018 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.16 (ruby-2.5.1).
</div>

    </div>
  </body>
</html>